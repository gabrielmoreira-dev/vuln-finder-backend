const axios = require('../infrastructure/axios')

module.exports = class {
  getVulnerability = async service => {
    const params = new URLSearchParams()
    params.append('advancedsearch', getAdvancedSearch(service))
    params.append('details', '1')
    params.append('limit', process.env.VULDB_API_LIMIT)

    return axios.post('', params)
  }
}

const getAdvancedSearch = service => {
  const { vendor, product, version } = service
  let search = ''

  if (vendor) {
    search += `vendor:${vendor}`
    if (product || version) {
      search += ','
    }
  }
  if (product) {
    search += `product:${product}`
    if (version) {
      search += ','
    }
  }
  if (version) {
    search += `version:${version}`
  }

  return search
}